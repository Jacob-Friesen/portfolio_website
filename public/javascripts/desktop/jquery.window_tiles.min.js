(function(a){jQuery.fn.window_tiles=function(g){this.settings={after:[]};g&&a.extend(this.settings,g);this.tile_list=[];this.init_menu=function(){for(var a=0;2>a;a++)this.set_tiles(a)};this.set_tiles=function(d){this.tile_list[d]=[];a("#tile_menu_cent"+d+" > button").each(a.proxy(function(b,c){this.tile_list[d].push(Window_Tile(c,d,b,this.settings.after[b],this));var e=this.tile_list[d].length;a(c).click(a.proxy(function(){this.open_item(d,e-1)},this))},this))};this.trigger_open=function(a){var b=
this.is_open(a);if(-1==b)for(var c=0;c<this.tile_list.length;c++){for(var e=!1,b=0;b<this.tile_list[c].length&&!1==e;b++)null!=this.tile_list[c][b].close_btn&&(e=!0);if(c==this.tile_list.length-1||!1==e){for(b=0;b<this.tile_list.length;b++){if(this.tile_list[b][a]){var f=this.close_tile(b);this.open_item(b,a)}a=f}break}}else 0<b&&(f=this.close_tile(0),this.close_tile(1),this.open_item(1,f),this.open_item(0,a))};this.is_open=function(a){for(var b=0;b<this.tile_list.length;b++)if(this.tile_list[b][a]&&
null!=this.tile_list[b][a].close_btn)return b;return-1};this.close_tile=function(a){for(var b=0;b<this.tile_list[a].length;b++)if(null!=this.tile_list[a][b].close_btn)return this.close_item(a,b),b;return-1};this.close_item=function(a,b){this.tile_list[a][b].close_obj();this.extra(b,!1)};this.open_item=function(a,b){this.tile_list[a][b].open_obj();0==a&&pages.update_url(b);this.extra(b,!0)};this.extra=function(d,b){var c="none";!1==b&&(c="inline");a(".tile_menu_cent").each(function(b,f){a(f).children()[d].style.display=
c})};this.init_menu();return this};Class.create(function Window_Tile(g,d,b,c,e){return{OPEN_TITLE:"Open...",FILE_TYPE:"_page_load",TILE_NUM:d,ITEM_NUM:b,close_btn:null,child:null,item_id:g.id.replace("Btn",""),into:g.parentNode.parentNode.parentNode,into_html:null,into_old_xy:[null,null],tiles:e,exec_after:c,open_obj:function(){var b=a("#"+this.item_id);null==b[0]?a.ajax({url:this.item_id+this.FILE_TYPE,context:this,success:this.render_child}):this.render_child(b[0].innerHTML,!0)},render_child:function(b,c){!0!=
c&&a(document.body).append(a('<div id="'+this.item_id+'" style="display: none">'+b+"</div>"));null==this.into_html&&(this.into_html=this.into.innerHTML,this.into_old_xy=[a(this.into).height(),a(this.into).width()]);this.into.innerHTML=b;this.child=a(this.into).children(":first")[0];this.child.style.display="inline";a(this.into).height(a(this.child).height()+2);a(this.into).width(a(this.child).width());a(this.child).watch("height, width",function(){a(this.parentNode).height(a(this).height()+2);a(this.parentNode).width(a(this).width())});
"Microsoft Internet Explorer"==navigator.appName&&this.IE_Listen();this.close_btn=a(this.child).find("#closeBtn");if(null==this.close_btn)throw"could not find close button for: "+this.item_id;a(this.child).find("#closeBtn").click(a.proxy(function(){this.close_btn=null;a(this.child.parentNode).height(this.into_old_xy[0]);a(this.child.parentNode).width(this.into_old_xy[1]);this.child.parentNode.innerHTML=this.into_html;this.tiles.set_tiles(this.TILE_NUM);this.adtnl_work(a(this.into).children(":first")[0]);
this.tiles.extra(this.ITEM_NUM,false)},this));this.adtnl_work(this.child)},IE_Listen:function(){this.child.onpropertychange=function(){CHECK=50;this.height=0;a(this).children().each(a.proxy(function(b,f){this.height+=a(f).height()},this));a(this.parentNode).height(this.height+45);a(this.parentNode).width(a(this).width());var b=this;setTimeout(function(){b.fireEvent("onpropertychange",document.createEventObject())},CHECK)}},adtnl_work:function(b){var c=!1;a(b.parentNode.parentNode).width(a(b.parentNode).width());
b=a("#panel_title"+this.TILE_NUM)[0];b.innerHTML==this.OPEN_TITLE?(b.innerHTML="",c=!0):b.innerHTML=this.OPEN_TITLE;this.resize_ws();if(null==this.exec_after)throw"Error: exec_after must be specified";!0==c&&this.exec_after()},resize_ws:function(){var b=a("#window_set"),c=a("#window_container0"),d=a("#window_container1"),c=c.width()+d.width()+0.05*b.width();c>b.width()&&b.width(1.05*c)},close_obj:function(){this.close_btn.click()}}},this)})(jQuery);
