//Jacob Friesen, www.jacobfriesen.com, F.Jacob.J@gmail.com, GNU 2010
(function(a){jQuery.fn.registerMovable=function(b){var c=1,d=!1,f=this,h=this.attr("id"),e=0,i=0,g={canvasName:null,lineWidth:1,speed:1};b&&a.extend(g,b);if(g.canvasName!=null){var j=registerObject(g.canvasName,this.attr("id"),g.lineWidth);this.mousedown(function(a){d=!0;var b=f.offset();e=b.top-a.pageY;i=b.left-a.pageX;return this});a(document).mousemove(function(a){d==!0&&(left=a.pageX+i,top=a.pageY+e,c>g.speed?(j(a.pageX+i,a.pageY+e),c=0):c++);return this});a(document).mouseup(function(){d==!0&& endObjectMove(g.canvasName,h);d=!1})}else console.log("Error: There is no canvas name specified.");return this};jQuery.fn.deRegisterMovable=function(b){var c={canvasName:null};b&&a.extend(c,b);c.canvasName!=null?(this.unbind("mousedown"),a(document).unbind("mousemove"),a(document).unbind("mouseup")):console.log("Error: There is no canvas name specified.");return this}})(jQuery);var canvasObjects=[],prevX=0,prevY=0,started=!1; function partial(a){var b=Array.prototype.slice.call(arguments,1);return function(){var c=b.concat(Array.prototype.slice.call(arguments));return a.apply(this,c)}} function initMovCanvas(a){if(document.createElement("canvas").getContext){var b=document.getElementById(a);if(b=="[object HTMLCanvasElement]"){b.style.position="absolute";if(b.left==null)b.left=0;if(b.right==null)b.top=0;setCDimen(b);tempCanvas=new canvasObject(b);canvasObjects.push(tempCanvas);return tempCanvas}else console.log('Error: A canvas element with id "'+a+'" was not found.')}else alert("Error: browser does not support canvas, provide a way to detect this before you call this plugins functions."); return null}function registerObject(a,b,c){var d=findCanvas(a);d==null&&(d=initMovCanvas(a));if(d!=null)if(c!=null&&d.setlWidth(c),a=document.getElementById(b),a!=null)return a.style.position="absolute",d.addMovable(a),partial(moveObjectFast,d,a);else console.log('Error: The item with id "'+b+'" was not found.');return null}function moveObjectFast(a,b,c,d){var f=a.getCanvas().getContext("2d");moveObjR(f,a.getCanvas(),c,d,b.offsetWidth,b.offsetHeight,a.getlWidth())} function moveObjR(a,b,c,d,f,h,e){started==!1&&startCMove(b);b=e/2;a.clearRect(prevX-b-1,prevY-b-1,f+e+2,h+e+2);a.lineWidth=e;a.strokeRect(c,d,f,h);prevX=c;prevY=d}function startCMove(a){setCDimen(a);document.getElementById("page").zIndex="-1";a.style.zIndex="999";started=!0} function endObjectMove(a,b){cObject=findCanvas(a);object=cObject.getMovableByName(b);document.getElementById("page").zIndex="1";var c=cObject.getCanvas();c.style.zIndex="-1";c.width=c.width;if(started!=!1)object.style.left=prevX+"px",object.style.top=prevY+"px";started=!1} function setCDimen(a){a.width=window.innerWidth;if(a.width==0)a.width=document.body.parentNode.scrollWidth;a.height=window.innerHeight;if(a.height==0)a.height=document.body.parentNode.scrollHeight;if(a.height==0)a.height=document.body.scrollHeight}function findCanvas(a){for(var b=0;b<canvasObjects.length;b++)if(canvasObjects[b].getCanvas().id==a)return canvasObjects[b];return null} function canvasObject(a){this.canvas=a;this.movables=[];this.lWidth=1;this.getCanvas=function(){return this.canvas};this.getlWidth=function(){return this.lWidth};this.setlWidth=function(a){this.lWidth=a};this.addMovable=function(a){this.movables.push(a)};this.getMovableByName=function(a){return this.getMovable(document.getElementById(a))};this.getMovable=function(a){for(var c=0;c<this.movables.length;c++)if(this.movables[c]==a)return this.movables[c];return null};return!0};